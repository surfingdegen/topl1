{"ast":null,"code":"import { parseAccount } from '../../accounts/utils/parseAccount.js';\nimport { BaseFeeScalarError } from '../../errors/fee.js';\nimport { getTransactionError } from '../../utils/errors/getTransactionError.js';\nimport { extract } from '../../utils/formatters/extract.js';\nimport { formatTransaction } from '../../utils/formatters/transaction.js';\nimport { formatTransactionRequest } from '../../utils/formatters/transactionRequest.js';\nimport { getAction } from '../../utils/getAction.js';\nimport { assertRequest } from '../../utils/transaction/assertRequest.js';\nimport { getBlock } from './getBlock.js';\nimport { getChainId as getChainId_ } from './getChainId.js';\n/**\n * Fills a transaction request with the necessary fields to be signed over.\n *\n * - Docs: https://viem.sh/docs/actions/public/fillTransaction\n *\n * @param client - Client to use\n * @param parameters - {@link FillTransactionParameters}\n * @returns The filled transaction. {@link FillTransactionReturnType}\n *\n * @example\n * import { createPublicClient, http } from 'viem'\n * import { mainnet } from 'viem/chains'\n * import { fillTransaction } from 'viem/public'\n *\n * const client = createPublicClient({\n *   chain: mainnet,\n *   transport: http(),\n * })\n * const result = await fillTransaction(client, {\n *   account: '0xA0Cf798816D4b9b9866b5330EEa46a18382f251e',\n *   to: '0x70997970c51812dc3a010c7d01b50e0d17dc79c8',\n *   value: parseEther('1'),\n * })\n */\nexport async function fillTransaction(client, parameters) {\n  const {\n    account = client.account,\n    accessList,\n    authorizationList,\n    chain = client.chain,\n    blobVersionedHashes,\n    blobs,\n    data,\n    gas,\n    gasPrice,\n    maxFeePerBlobGas,\n    maxFeePerGas,\n    maxPriorityFeePerGas,\n    nonce: nonce_,\n    nonceManager,\n    to,\n    type,\n    value,\n    ...rest\n  } = parameters;\n  const nonce = await (async () => {\n    if (!account) return nonce_;\n    if (!nonceManager) return nonce_;\n    if (typeof nonce_ !== 'undefined') return nonce_;\n    const account_ = parseAccount(account);\n    const chainId = chain ? chain.id : await getAction(client, getChainId_, 'getChainId')({});\n    return await nonceManager.consume({\n      address: account_.address,\n      chainId,\n      client\n    });\n  })();\n  assertRequest(parameters);\n  const chainFormat = chain?.formatters?.transactionRequest?.format;\n  const format = chainFormat || formatTransactionRequest;\n  const request = format({\n    // Pick out extra data that might exist on the chain's transaction request type.\n    ...extract(rest, {\n      format: chainFormat\n    }),\n    account: account ? parseAccount(account) : undefined,\n    accessList,\n    authorizationList,\n    blobs,\n    blobVersionedHashes,\n    data,\n    gas,\n    gasPrice,\n    maxFeePerBlobGas,\n    maxFeePerGas,\n    maxPriorityFeePerGas,\n    nonce,\n    to,\n    type,\n    value\n  }, 'fillTransaction');\n  try {\n    const response = await client.request({\n      method: 'eth_fillTransaction',\n      params: [request]\n    });\n    const format = chain?.formatters?.transaction?.format || formatTransaction;\n    const transaction = format(response.tx);\n    // Remove unnecessary fields.\n    delete transaction.blockHash;\n    delete transaction.blockNumber;\n    delete transaction.r;\n    delete transaction.s;\n    delete transaction.transactionIndex;\n    delete transaction.v;\n    delete transaction.yParity;\n    // Rewrite fields.\n    transaction.data = transaction.input;\n    // Preference supplied fees (some nodes do not take these preferences).\n    if (transaction.gas) transaction.gas = parameters.gas ?? transaction.gas;\n    if (transaction.gasPrice) transaction.gasPrice = parameters.gasPrice ?? transaction.gasPrice;\n    if (transaction.maxFeePerBlobGas) transaction.maxFeePerBlobGas = parameters.maxFeePerBlobGas ?? transaction.maxFeePerBlobGas;\n    if (transaction.maxFeePerGas) transaction.maxFeePerGas = parameters.maxFeePerGas ?? transaction.maxFeePerGas;\n    if (transaction.maxPriorityFeePerGas) transaction.maxPriorityFeePerGas = parameters.maxPriorityFeePerGas ?? transaction.maxPriorityFeePerGas;\n    if (transaction.nonce) transaction.nonce = parameters.nonce ?? transaction.nonce;\n    // Build fee multiplier function.\n    const feeMultiplier = await (async () => {\n      if (typeof chain?.fees?.baseFeeMultiplier === 'function') {\n        const block = await getAction(client, getBlock, 'getBlock')({});\n        return chain.fees.baseFeeMultiplier({\n          block,\n          client,\n          request: parameters\n        });\n      }\n      return chain?.fees?.baseFeeMultiplier ?? 1.2;\n    })();\n    if (feeMultiplier < 1) throw new BaseFeeScalarError();\n    const decimals = feeMultiplier.toString().split('.')[1]?.length ?? 0;\n    const denominator = 10 ** decimals;\n    const multiplyFee = base => base * BigInt(Math.ceil(feeMultiplier * denominator)) / BigInt(denominator);\n    // Apply fee multiplier.\n    if (transaction.maxFeePerGas && !parameters.maxFeePerGas) transaction.maxFeePerGas = multiplyFee(transaction.maxFeePerGas);\n    if (transaction.gasPrice && !parameters.gasPrice) transaction.gasPrice = multiplyFee(transaction.gasPrice);\n    return {\n      raw: response.raw,\n      transaction: {\n        from: request.from,\n        ...transaction\n      }\n    };\n  } catch (err) {\n    throw getTransactionError(err, {\n      ...parameters,\n      chain: client.chain\n    });\n  }\n}","map":{"version":3,"names":["parseAccount","BaseFeeScalarError","getTransactionError","extract","formatTransaction","formatTransactionRequest","getAction","assertRequest","getBlock","getChainId","getChainId_","fillTransaction","client","parameters","account","accessList","authorizationList","chain","blobVersionedHashes","blobs","data","gas","gasPrice","maxFeePerBlobGas","maxFeePerGas","maxPriorityFeePerGas","nonce","nonce_","nonceManager","to","type","value","rest","account_","chainId","id","consume","address","chainFormat","formatters","transactionRequest","format","request","undefined","response","method","params","transaction","tx","blockHash","blockNumber","r","s","transactionIndex","v","yParity","input","feeMultiplier","fees","baseFeeMultiplier","block","decimals","toString","split","length","denominator","multiplyFee","base","BigInt","Math","ceil","raw","from","err"],"sources":["/Users/mac/Desktop/topl1/frontend/node_modules/viem/actions/public/fillTransaction.ts"],"sourcesContent":["import type { Address } from 'abitype'\nimport { parseAccount } from '../../accounts/utils/parseAccount.js'\nimport type { Client } from '../../clients/createClient.js'\nimport type { Transport } from '../../clients/transports/createTransport.js'\nimport type { BaseError } from '../../errors/base.js'\nimport { BaseFeeScalarError } from '../../errors/fee.js'\nimport type { ErrorType } from '../../errors/utils.js'\nimport type { Account, GetAccountParameter } from '../../types/account.js'\nimport type {\n  Chain,\n  ChainFeesFnParameters,\n  DeriveChain,\n  GetChainParameter,\n} from '../../types/chain.js'\nimport type { Hex } from '../../types/misc.js'\nimport type { TransactionRequest } from '../../types/transaction.js'\nimport type { UnionOmit } from '../../types/utils.js'\nimport {\n  type GetTransactionErrorReturnType,\n  getTransactionError,\n} from '../../utils/errors/getTransactionError.js'\nimport { extract } from '../../utils/formatters/extract.js'\nimport {\n  type FormattedTransaction,\n  formatTransaction,\n} from '../../utils/formatters/transaction.js'\nimport {\n  type FormattedTransactionRequest,\n  formatTransactionRequest,\n} from '../../utils/formatters/transactionRequest.js'\nimport { getAction } from '../../utils/getAction.js'\nimport type { NonceManager } from '../../utils/nonceManager.js'\nimport { assertRequest } from '../../utils/transaction/assertRequest.js'\nimport { getBlock } from './getBlock.js'\nimport { getChainId as getChainId_ } from './getChainId.js'\n\nexport type FillTransactionParameters<\n  chain extends Chain | undefined = Chain | undefined,\n  account extends Account | undefined = Account | undefined,\n  chainOverride extends Chain | undefined = Chain | undefined,\n  accountOverride extends Account | Address | undefined =\n    | Account\n    | Address\n    | undefined,\n  ///\n  _derivedChain extends Chain | undefined = DeriveChain<chain, chainOverride>,\n> = UnionOmit<FormattedTransactionRequest<_derivedChain>, 'from'> &\n  GetAccountParameter<account, accountOverride, false, true> &\n  GetChainParameter<chain, chainOverride> & {\n    /**\n     * Nonce manager to use for the transaction request.\n     */\n    nonceManager?: NonceManager | undefined\n  }\n\nexport type FillTransactionReturnType<\n  chain extends Chain | undefined = Chain | undefined,\n  chainOverride extends Chain | undefined = Chain | undefined,\n  ///\n  _derivedChain extends Chain | undefined = DeriveChain<chain, chainOverride>,\n> = {\n  raw: Hex\n  transaction: FormattedTransaction<_derivedChain>\n}\n\nexport type FillTransactionErrorType =\n  | GetTransactionErrorReturnType<ErrorType>\n  | ErrorType\n\n/**\n * Fills a transaction request with the necessary fields to be signed over.\n *\n * - Docs: https://viem.sh/docs/actions/public/fillTransaction\n *\n * @param client - Client to use\n * @param parameters - {@link FillTransactionParameters}\n * @returns The filled transaction. {@link FillTransactionReturnType}\n *\n * @example\n * import { createPublicClient, http } from 'viem'\n * import { mainnet } from 'viem/chains'\n * import { fillTransaction } from 'viem/public'\n *\n * const client = createPublicClient({\n *   chain: mainnet,\n *   transport: http(),\n * })\n * const result = await fillTransaction(client, {\n *   account: '0xA0Cf798816D4b9b9866b5330EEa46a18382f251e',\n *   to: '0x70997970c51812dc3a010c7d01b50e0d17dc79c8',\n *   value: parseEther('1'),\n * })\n */\nexport async function fillTransaction<\n  chain extends Chain | undefined,\n  account extends Account | undefined,\n  chainOverride extends Chain | undefined = undefined,\n  accountOverride extends Account | Address | undefined = undefined,\n>(\n  client: Client<Transport, chain, account>,\n  parameters: FillTransactionParameters<\n    chain,\n    account,\n    chainOverride,\n    accountOverride\n  >,\n): Promise<FillTransactionReturnType<chain, chainOverride>> {\n  const {\n    account = client.account,\n    accessList,\n    authorizationList,\n    chain = client.chain,\n    blobVersionedHashes,\n    blobs,\n    data,\n    gas,\n    gasPrice,\n    maxFeePerBlobGas,\n    maxFeePerGas,\n    maxPriorityFeePerGas,\n    nonce: nonce_,\n    nonceManager,\n    to,\n    type,\n    value,\n    ...rest\n  } = parameters\n\n  const nonce = await (async () => {\n    if (!account) return nonce_\n    if (!nonceManager) return nonce_\n    if (typeof nonce_ !== 'undefined') return nonce_\n    const account_ = parseAccount(account)\n    const chainId = chain\n      ? chain.id\n      : await getAction(client, getChainId_, 'getChainId')({})\n    return await nonceManager.consume({\n      address: account_.address,\n      chainId,\n      client,\n    })\n  })()\n\n  assertRequest(parameters)\n\n  const chainFormat = chain?.formatters?.transactionRequest?.format\n  const format = chainFormat || formatTransactionRequest\n\n  const request = format(\n    {\n      // Pick out extra data that might exist on the chain's transaction request type.\n      ...extract(rest, { format: chainFormat }),\n      account: account ? parseAccount(account) : undefined,\n      accessList,\n      authorizationList,\n      blobs,\n      blobVersionedHashes,\n      data,\n      gas,\n      gasPrice,\n      maxFeePerBlobGas,\n      maxFeePerGas,\n      maxPriorityFeePerGas,\n      nonce,\n      to,\n      type,\n      value,\n    } as TransactionRequest,\n    'fillTransaction',\n  )\n\n  try {\n    const response = await client.request({\n      method: 'eth_fillTransaction',\n      params: [request],\n    })\n    const format = chain?.formatters?.transaction?.format || formatTransaction\n\n    const transaction = format(response.tx)\n\n    // Remove unnecessary fields.\n    delete transaction.blockHash\n    delete transaction.blockNumber\n    delete transaction.r\n    delete transaction.s\n    delete transaction.transactionIndex\n    delete transaction.v\n    delete transaction.yParity\n\n    // Rewrite fields.\n    transaction.data = transaction.input\n\n    // Preference supplied fees (some nodes do not take these preferences).\n    if (transaction.gas) transaction.gas = parameters.gas ?? transaction.gas\n    if (transaction.gasPrice)\n      transaction.gasPrice = parameters.gasPrice ?? transaction.gasPrice\n    if (transaction.maxFeePerBlobGas)\n      transaction.maxFeePerBlobGas =\n        parameters.maxFeePerBlobGas ?? transaction.maxFeePerBlobGas\n    if (transaction.maxFeePerGas)\n      transaction.maxFeePerGas =\n        parameters.maxFeePerGas ?? transaction.maxFeePerGas\n    if (transaction.maxPriorityFeePerGas)\n      transaction.maxPriorityFeePerGas =\n        parameters.maxPriorityFeePerGas ?? transaction.maxPriorityFeePerGas\n    if (transaction.nonce)\n      transaction.nonce = parameters.nonce ?? transaction.nonce\n\n    // Build fee multiplier function.\n    const feeMultiplier = await (async () => {\n      if (typeof chain?.fees?.baseFeeMultiplier === 'function') {\n        const block = await getAction(client, getBlock, 'getBlock')({})\n        return chain.fees.baseFeeMultiplier({\n          block,\n          client,\n          request: parameters,\n        } as ChainFeesFnParameters)\n      }\n      return chain?.fees?.baseFeeMultiplier ?? 1.2\n    })()\n    if (feeMultiplier < 1) throw new BaseFeeScalarError()\n\n    const decimals = feeMultiplier.toString().split('.')[1]?.length ?? 0\n    const denominator = 10 ** decimals\n    const multiplyFee = (base: bigint) =>\n      (base * BigInt(Math.ceil(feeMultiplier * denominator))) /\n      BigInt(denominator)\n\n    // Apply fee multiplier.\n    if (transaction.maxFeePerGas && !parameters.maxFeePerGas)\n      transaction.maxFeePerGas = multiplyFee(transaction.maxFeePerGas)\n    if (transaction.gasPrice && !parameters.gasPrice)\n      transaction.gasPrice = multiplyFee(transaction.gasPrice)\n\n    return {\n      raw: response.raw,\n      transaction: {\n        from: request.from,\n        ...transaction,\n      },\n    }\n  } catch (err) {\n    throw getTransactionError(\n      err as BaseError,\n      {\n        ...parameters,\n        chain: client.chain,\n      } as never,\n    )\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}