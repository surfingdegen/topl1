{"ast":null,"code":"// Copyright (c) 2018-2023 Coinbase, Inc. <https://www.coinbase.com/>\nimport { sha256 } from '@noble/hashes/sha256';\nimport { bytesToHex } from '@noble/hashes/utils';\nimport { randomBytesHex } from '../../../../core/type/util.js';\nconst STORAGE_KEY_SESSION_ID = 'session:id';\nconst STORAGE_KEY_SESSION_SECRET = 'session:secret';\nconst STORAGE_KEY_SESSION_LINKED = 'session:linked';\nexport class WalletLinkSession {\n  constructor(storage, id, secret) {\n    let linked = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n    this.storage = storage;\n    this.id = id;\n    this.secret = secret;\n    this.key = bytesToHex(sha256(\"\".concat(id, \", \").concat(secret, \" WalletLink\")));\n    this._linked = !!linked;\n  }\n  static create(storage) {\n    const id = randomBytesHex(16);\n    const secret = randomBytesHex(32);\n    return new WalletLinkSession(storage, id, secret).save();\n  }\n  static load(storage) {\n    const id = storage.getItem(STORAGE_KEY_SESSION_ID);\n    const linked = storage.getItem(STORAGE_KEY_SESSION_LINKED);\n    const secret = storage.getItem(STORAGE_KEY_SESSION_SECRET);\n    if (id && secret) {\n      return new WalletLinkSession(storage, id, secret, linked === '1');\n    }\n    return null;\n  }\n  get linked() {\n    return this._linked;\n  }\n  set linked(val) {\n    this._linked = val;\n    this.persistLinked();\n  }\n  save() {\n    this.storage.setItem(STORAGE_KEY_SESSION_ID, this.id);\n    this.storage.setItem(STORAGE_KEY_SESSION_SECRET, this.secret);\n    this.persistLinked();\n    return this;\n  }\n  persistLinked() {\n    this.storage.setItem(STORAGE_KEY_SESSION_LINKED, this._linked ? '1' : '0');\n  }\n}","map":{"version":3,"names":["sha256","bytesToHex","randomBytesHex","STORAGE_KEY_SESSION_ID","STORAGE_KEY_SESSION_SECRET","STORAGE_KEY_SESSION_LINKED","WalletLinkSession","constructor","storage","id","secret","linked","arguments","length","undefined","key","concat","_linked","create","save","load","getItem","val","persistLinked","setItem"],"sources":["../../../../../src/sign/walletlink/relay/type/WalletLinkSession.ts"],"sourcesContent":[null],"mappings":"AAAA;AAEA,SAASA,MAAM,QAAQ,sBAAsB;AAC7C,SAASC,UAAU,QAAQ,qBAAqB;AAGhD,SAASC,cAAc,QAAQ,+BAAqB;AAEpD,MAAMC,sBAAsB,GAAG,YAAY;AAC3C,MAAMC,0BAA0B,GAAG,gBAAgB;AACnD,MAAMC,0BAA0B,GAAG,gBAAgB;AAEnD,OAAM,MAAOC,iBAAiB;EAI5BC,YACWC,OAA2B,EAC3BC,EAAU,EACVC,MAAc,EACT;IAAA,IAAdC,MAAM,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,KAAK;IAHL,KAAAJ,OAAO,GAAPA,OAAO;IACP,KAAAC,EAAE,GAAFA,EAAE;IACF,KAAAC,MAAM,GAANA,MAAM;IAGf,IAAI,CAACK,GAAG,GAAGd,UAAU,CAACD,MAAM,IAAAgB,MAAA,CAAIP,EAAE,QAAAO,MAAA,CAAKN,MAAM,gBAAa,CAAC,CAAC;IAC5D,IAAI,CAACO,OAAO,GAAG,CAAC,CAACN,MAAM;EACzB;EAEO,OAAOO,MAAMA,CAACV,OAA2B;IAC9C,MAAMC,EAAE,GAAGP,cAAc,CAAC,EAAE,CAAC;IAC7B,MAAMQ,MAAM,GAAGR,cAAc,CAAC,EAAE,CAAC;IACjC,OAAO,IAAII,iBAAiB,CAACE,OAAO,EAAEC,EAAE,EAAEC,MAAM,CAAC,CAACS,IAAI,EAAE;EAC1D;EAEO,OAAOC,IAAIA,CAACZ,OAA2B;IAC5C,MAAMC,EAAE,GAAGD,OAAO,CAACa,OAAO,CAAClB,sBAAsB,CAAC;IAClD,MAAMQ,MAAM,GAAGH,OAAO,CAACa,OAAO,CAAChB,0BAA0B,CAAC;IAC1D,MAAMK,MAAM,GAAGF,OAAO,CAACa,OAAO,CAACjB,0BAA0B,CAAC;IAE1D,IAAIK,EAAE,IAAIC,MAAM,EAAE;MAChB,OAAO,IAAIJ,iBAAiB,CAACE,OAAO,EAAEC,EAAE,EAAEC,MAAM,EAAEC,MAAM,KAAK,GAAG,CAAC;IACnE;IAEA,OAAO,IAAI;EACb;EAEA,IAAWA,MAAMA,CAAA;IACf,OAAO,IAAI,CAACM,OAAO;EACrB;EAEA,IAAWN,MAAMA,CAACW,GAAY;IAC5B,IAAI,CAACL,OAAO,GAAGK,GAAG;IAClB,IAAI,CAACC,aAAa,EAAE;EACtB;EAEOJ,IAAIA,CAAA;IACT,IAAI,CAACX,OAAO,CAACgB,OAAO,CAACrB,sBAAsB,EAAE,IAAI,CAACM,EAAE,CAAC;IACrD,IAAI,CAACD,OAAO,CAACgB,OAAO,CAACpB,0BAA0B,EAAE,IAAI,CAACM,MAAM,CAAC;IAC7D,IAAI,CAACa,aAAa,EAAE;IACpB,OAAO,IAAI;EACb;EAEQA,aAAaA,CAAA;IACnB,IAAI,CAACf,OAAO,CAACgB,OAAO,CAACnB,0BAA0B,EAAE,IAAI,CAACY,OAAO,GAAG,GAAG,GAAG,GAAG,CAAC;EAC5E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}