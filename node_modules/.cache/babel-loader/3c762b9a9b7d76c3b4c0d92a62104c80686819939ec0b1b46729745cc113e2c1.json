{"ast":null,"code":"// Copyright (c) 2018-2024 Coinbase, Inc. <https://www.coinbase.com/>\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-nocheck\nimport eip712 from '../../vendor-js/eth-eip712-util/index.cjs';\nimport { LOCAL_STORAGE_ADDRESSES_KEY } from './relay/constants.js';\nimport { isErrorResponse } from './relay/type/Web3Response.js';\nimport { WalletLinkRelay } from './relay/WalletLinkRelay.js';\nimport { WALLETLINK_URL } from '../../core/constants.js';\nimport { standardErrors } from '../../core/error/errors.js';\nimport { ScopedLocalStorage } from '../../core/storage/ScopedLocalStorage.js';\nimport { encodeToHexString, ensureAddressString, ensureBigInt, ensureBuffer, ensureIntNumber, ensureParsedJSONObject, hexStringFromBuffer, hexStringFromNumber } from '../../core/type/util.js';\nimport { fetchRPCRequest } from '../../util/provider.js';\nconst DEFAULT_CHAIN_ID_KEY = 'DefaultChainId';\nconst DEFAULT_JSON_RPC_URL = 'DefaultJsonRpcUrl';\n// original source: https://github.com/coinbase/coinbase-wallet-sdk/blob/v3.7.1/packages/wallet-sdk/src/provider/CoinbaseWalletProvider.ts\nexport class WalletLinkSigner {\n  constructor(options) {\n    this._relay = null;\n    this._addresses = [];\n    this.metadata = options.metadata;\n    this._storage = new ScopedLocalStorage('walletlink', WALLETLINK_URL);\n    this.callback = options.callback || null;\n    const cachedAddresses = this._storage.getItem(LOCAL_STORAGE_ADDRESSES_KEY);\n    if (cachedAddresses) {\n      const addresses = cachedAddresses.split(' ');\n      if (addresses[0] !== '') {\n        this._addresses = addresses.map(address => ensureAddressString(address));\n      }\n    }\n    this.initializeRelay();\n  }\n  getSession() {\n    const relay = this.initializeRelay();\n    const {\n      id,\n      secret\n    } = relay.getWalletLinkSession();\n    return {\n      id,\n      secret\n    };\n  }\n  async handshake() {\n    await this._eth_requestAccounts();\n  }\n  get selectedAddress() {\n    return this._addresses[0] || undefined;\n  }\n  get jsonRpcUrl() {\n    var _a;\n    return (_a = this._storage.getItem(DEFAULT_JSON_RPC_URL)) !== null && _a !== void 0 ? _a : undefined;\n  }\n  set jsonRpcUrl(value) {\n    this._storage.setItem(DEFAULT_JSON_RPC_URL, value);\n  }\n  updateProviderInfo(jsonRpcUrl, chainId) {\n    var _a;\n    this.jsonRpcUrl = jsonRpcUrl;\n    // emit chainChanged event if necessary\n    const originalChainId = this.getChainId();\n    this._storage.setItem(DEFAULT_CHAIN_ID_KEY, chainId.toString(10));\n    const chainChanged = ensureIntNumber(chainId) !== originalChainId;\n    if (chainChanged) {\n      (_a = this.callback) === null || _a === void 0 ? void 0 : _a.call(this, 'chainChanged', hexStringFromNumber(chainId));\n    }\n  }\n  async watchAsset(params) {\n    const request = Array.isArray(params) ? params[0] : params;\n    if (!request.type) {\n      throw standardErrors.rpc.invalidParams('Type is required');\n    }\n    if ((request === null || request === void 0 ? void 0 : request.type) !== 'ERC20') {\n      throw standardErrors.rpc.invalidParams(\"Asset of type '\".concat(request.type, \"' is not supported\"));\n    }\n    if (!(request === null || request === void 0 ? void 0 : request.options)) {\n      throw standardErrors.rpc.invalidParams('Options are required');\n    }\n    if (!(request === null || request === void 0 ? void 0 : request.options.address)) {\n      throw standardErrors.rpc.invalidParams('Address is required');\n    }\n    const chainId = this.getChainId();\n    const {\n      address,\n      symbol,\n      image,\n      decimals\n    } = request.options;\n    const relay = this.initializeRelay();\n    const result = await relay.watchAsset(request.type, address, symbol, decimals, image, chainId === null || chainId === void 0 ? void 0 : chainId.toString());\n    if (isErrorResponse(result)) return false;\n    return !!result.result;\n  }\n  async addEthereumChain(params) {\n    var _a, _b;\n    const request = params[0];\n    if (((_a = request.rpcUrls) === null || _a === void 0 ? void 0 : _a.length) === 0) {\n      throw standardErrors.rpc.invalidParams('please pass in at least 1 rpcUrl');\n    }\n    if (!request.chainName || request.chainName.trim() === '') {\n      throw standardErrors.rpc.invalidParams('chainName is a required field');\n    }\n    if (!request.nativeCurrency) {\n      throw standardErrors.rpc.invalidParams('nativeCurrency is a required field');\n    }\n    const chainIdNumber = Number.parseInt(request.chainId, 16);\n    if (chainIdNumber === this.getChainId()) {\n      return false;\n    }\n    const relay = this.initializeRelay();\n    const {\n      rpcUrls = [],\n      blockExplorerUrls = [],\n      chainName,\n      iconUrls = [],\n      nativeCurrency\n    } = request;\n    const res = await relay.addEthereumChain(chainIdNumber.toString(), rpcUrls, iconUrls, blockExplorerUrls, chainName, nativeCurrency);\n    if (isErrorResponse(res)) return false;\n    if (((_b = res.result) === null || _b === void 0 ? void 0 : _b.isApproved) === true) {\n      this.updateProviderInfo(rpcUrls[0], chainIdNumber);\n      return null;\n    }\n    throw standardErrors.rpc.internal('unable to add ethereum chain');\n  }\n  async switchEthereumChain(params) {\n    const request = params[0];\n    const chainId = Number.parseInt(request.chainId, 16);\n    const relay = this.initializeRelay();\n    const res = await relay.switchEthereumChain(chainId.toString(10), this.selectedAddress || undefined);\n    if (isErrorResponse(res)) throw res;\n    const switchResponse = res.result;\n    if (switchResponse.isApproved && switchResponse.rpcUrl.length > 0) {\n      this.updateProviderInfo(switchResponse.rpcUrl, chainId);\n    }\n    return null;\n  }\n  async cleanup() {\n    this.callback = null;\n    if (this._relay) {\n      this._relay.resetAndReload();\n    }\n    this._storage.clear();\n  }\n  _setAddresses(addresses, _) {\n    var _a;\n    if (!Array.isArray(addresses)) {\n      throw new Error('addresses is not an array');\n    }\n    const newAddresses = addresses.map(address => ensureAddressString(address));\n    if (JSON.stringify(newAddresses) === JSON.stringify(this._addresses)) {\n      return;\n    }\n    this._addresses = newAddresses;\n    (_a = this.callback) === null || _a === void 0 ? void 0 : _a.call(this, 'accountsChanged', newAddresses);\n    this._storage.setItem(LOCAL_STORAGE_ADDRESSES_KEY, newAddresses.join(' '));\n  }\n  async request(request) {\n    const params = request.params || [];\n    switch (request.method) {\n      case 'eth_accounts':\n        return [...this._addresses];\n      case 'eth_coinbase':\n        return this.selectedAddress || null;\n      case 'net_version':\n        return this.getChainId().toString(10);\n      case 'eth_chainId':\n        return hexStringFromNumber(this.getChainId());\n      case 'eth_requestAccounts':\n        return this._eth_requestAccounts();\n      case 'eth_ecRecover':\n      case 'personal_ecRecover':\n        return this.ecRecover(request);\n      case 'personal_sign':\n        return this.personalSign(request);\n      case 'eth_signTransaction':\n        return this._eth_signTransaction(params);\n      case 'eth_sendRawTransaction':\n        return this._eth_sendRawTransaction(params);\n      case 'eth_sendTransaction':\n        return this._eth_sendTransaction(params);\n      case 'eth_signTypedData_v1':\n      case 'eth_signTypedData_v3':\n      case 'eth_signTypedData_v4':\n      case 'eth_signTypedData':\n        return this.signTypedData(request);\n      case 'wallet_addEthereumChain':\n        return this.addEthereumChain(params);\n      case 'wallet_switchEthereumChain':\n        return this.switchEthereumChain(params);\n      case 'wallet_watchAsset':\n        return this.watchAsset(params);\n      default:\n        if (!this.jsonRpcUrl) throw standardErrors.rpc.internal('No RPC URL set for chain');\n        return fetchRPCRequest(request, this.jsonRpcUrl);\n    }\n  }\n  _ensureKnownAddress(addressString) {\n    const addressStr = ensureAddressString(addressString);\n    const lowercaseAddresses = this._addresses.map(address => ensureAddressString(address));\n    if (!lowercaseAddresses.includes(addressStr)) {\n      throw new Error('Unknown Ethereum address');\n    }\n  }\n  _prepareTransactionParams(tx) {\n    const fromAddress = tx.from ? ensureAddressString(tx.from) : this.selectedAddress;\n    if (!fromAddress) {\n      throw new Error('Ethereum address is unavailable');\n    }\n    this._ensureKnownAddress(fromAddress);\n    const toAddress = tx.to ? ensureAddressString(tx.to) : null;\n    const weiValue = tx.value != null ? ensureBigInt(tx.value) : BigInt(0);\n    const data = tx.data ? ensureBuffer(tx.data) : Buffer.alloc(0);\n    const nonce = tx.nonce != null ? ensureIntNumber(tx.nonce) : null;\n    const gasPriceInWei = tx.gasPrice != null ? ensureBigInt(tx.gasPrice) : null;\n    const maxFeePerGas = tx.maxFeePerGas != null ? ensureBigInt(tx.maxFeePerGas) : null;\n    const maxPriorityFeePerGas = tx.maxPriorityFeePerGas != null ? ensureBigInt(tx.maxPriorityFeePerGas) : null;\n    const gasLimit = tx.gas != null ? ensureBigInt(tx.gas) : null;\n    const chainId = tx.chainId ? ensureIntNumber(tx.chainId) : this.getChainId();\n    return {\n      fromAddress,\n      toAddress,\n      weiValue,\n      data,\n      nonce,\n      gasPriceInWei,\n      maxFeePerGas,\n      maxPriorityFeePerGas,\n      gasLimit,\n      chainId\n    };\n  }\n  async ecRecover(request) {\n    const {\n      method,\n      params\n    } = request;\n    if (!Array.isArray(params)) throw standardErrors.rpc.invalidParams();\n    const relay = this.initializeRelay();\n    const res = await relay.sendRequest({\n      method: 'ethereumAddressFromSignedMessage',\n      params: {\n        message: encodeToHexString(params[0]),\n        signature: encodeToHexString(params[1]),\n        addPrefix: method === 'personal_ecRecover'\n      }\n    });\n    if (isErrorResponse(res)) throw res;\n    return res.result;\n  }\n  getChainId() {\n    var _a;\n    return Number.parseInt((_a = this._storage.getItem(DEFAULT_CHAIN_ID_KEY)) !== null && _a !== void 0 ? _a : '1', 10);\n  }\n  async _eth_requestAccounts() {\n    var _a, _b;\n    if (this._addresses.length > 0) {\n      (_a = this.callback) === null || _a === void 0 ? void 0 : _a.call(this, 'connect', {\n        chainId: hexStringFromNumber(this.getChainId())\n      });\n      return this._addresses;\n    }\n    const relay = this.initializeRelay();\n    const res = await relay.requestEthereumAccounts();\n    if (isErrorResponse(res)) throw res;\n    if (!res.result) {\n      throw new Error('accounts received is empty');\n    }\n    this._setAddresses(res.result);\n    (_b = this.callback) === null || _b === void 0 ? void 0 : _b.call(this, 'connect', {\n      chainId: hexStringFromNumber(this.getChainId())\n    });\n    return this._addresses;\n  }\n  async personalSign(_ref) {\n    let {\n      params\n    } = _ref;\n    if (!Array.isArray(params)) throw standardErrors.rpc.invalidParams();\n    const address = params[1];\n    const rawData = params[0];\n    this._ensureKnownAddress(address);\n    const relay = this.initializeRelay();\n    const res = await relay.sendRequest({\n      method: 'signEthereumMessage',\n      params: {\n        address: ensureAddressString(address),\n        message: encodeToHexString(rawData),\n        addPrefix: true,\n        typedDataJson: null\n      }\n    });\n    if (isErrorResponse(res)) throw res;\n    return res.result;\n  }\n  async _eth_signTransaction(params) {\n    const tx = this._prepareTransactionParams(params[0] || {});\n    const relay = this.initializeRelay();\n    const res = await relay.signEthereumTransaction(tx);\n    if (isErrorResponse(res)) throw res;\n    return res.result;\n  }\n  async _eth_sendRawTransaction(params) {\n    const signedTransaction = ensureBuffer(params[0]);\n    const relay = this.initializeRelay();\n    const res = await relay.submitEthereumTransaction(signedTransaction, this.getChainId());\n    if (isErrorResponse(res)) throw res;\n    return res.result;\n  }\n  async _eth_sendTransaction(params) {\n    const tx = this._prepareTransactionParams(params[0] || {});\n    const relay = this.initializeRelay();\n    const res = await relay.signAndSubmitEthereumTransaction(tx);\n    if (isErrorResponse(res)) throw res;\n    return res.result;\n  }\n  async signTypedData(request) {\n    const {\n      method,\n      params\n    } = request;\n    if (!Array.isArray(params)) throw standardErrors.rpc.invalidParams();\n    const encode = input => {\n      const hashFuncMap = {\n        eth_signTypedData_v1: eip712.hashForSignTypedDataLegacy,\n        eth_signTypedData_v3: eip712.hashForSignTypedData_v3,\n        eth_signTypedData_v4: eip712.hashForSignTypedData_v4,\n        eth_signTypedData: eip712.hashForSignTypedData_v4\n      };\n      return hexStringFromBuffer(hashFuncMap[method]({\n        data: ensureParsedJSONObject(input)\n      }), true);\n    };\n    const address = params[method === 'eth_signTypedData_v1' ? 1 : 0];\n    const rawData = params[method === 'eth_signTypedData_v1' ? 0 : 1];\n    this._ensureKnownAddress(address);\n    const relay = this.initializeRelay();\n    const res = await relay.sendRequest({\n      method: 'signEthereumMessage',\n      params: {\n        address: ensureAddressString(address),\n        message: encode(rawData),\n        typedDataJson: JSON.stringify(rawData, null, 2),\n        addPrefix: false\n      }\n    });\n    if (isErrorResponse(res)) throw res;\n    return res.result;\n  }\n  initializeRelay() {\n    if (!this._relay) {\n      this._relay = new WalletLinkRelay({\n        linkAPIUrl: WALLETLINK_URL,\n        storage: this._storage,\n        metadata: this.metadata,\n        accountsCallback: this._setAddresses.bind(this),\n        chainCallback: this.updateProviderInfo.bind(this)\n      });\n    }\n    return this._relay;\n  }\n}","map":{"version":3,"names":["eip712","LOCAL_STORAGE_ADDRESSES_KEY","isErrorResponse","WalletLinkRelay","WALLETLINK_URL","standardErrors","ScopedLocalStorage","encodeToHexString","ensureAddressString","ensureBigInt","ensureBuffer","ensureIntNumber","ensureParsedJSONObject","hexStringFromBuffer","hexStringFromNumber","fetchRPCRequest","DEFAULT_CHAIN_ID_KEY","DEFAULT_JSON_RPC_URL","WalletLinkSigner","constructor","options","_relay","_addresses","metadata","_storage","callback","cachedAddresses","getItem","addresses","split","map","address","initializeRelay","getSession","relay","id","secret","getWalletLinkSession","handshake","_eth_requestAccounts","selectedAddress","undefined","jsonRpcUrl","_a","value","setItem","updateProviderInfo","chainId","originalChainId","getChainId","toString","chainChanged","call","watchAsset","params","request","Array","isArray","type","rpc","invalidParams","concat","symbol","image","decimals","result","addEthereumChain","rpcUrls","length","chainName","trim","nativeCurrency","chainIdNumber","Number","parseInt","blockExplorerUrls","iconUrls","res","_b","isApproved","internal","switchEthereumChain","switchResponse","rpcUrl","cleanup","resetAndReload","clear","_setAddresses","_","Error","newAddresses","JSON","stringify","join","method","ecRecover","personalSign","_eth_signTransaction","_eth_sendRawTransaction","_eth_sendTransaction","signTypedData","_ensureKnownAddress","addressString","addressStr","lowercaseAddresses","includes","_prepareTransactionParams","tx","fromAddress","from","toAddress","to","weiValue","BigInt","data","Buffer","alloc","nonce","gasPriceInWei","gasPrice","maxFeePerGas","maxPriorityFeePerGas","gasLimit","gas","sendRequest","message","signature","addPrefix","requestEthereumAccounts","_ref","rawData","typedDataJson","signEthereumTransaction","signedTransaction","submitEthereumTransaction","signAndSubmitEthereumTransaction","encode","input","hashFuncMap","eth_signTypedData_v1","hashForSignTypedDataLegacy","eth_signTypedData_v3","hashForSignTypedData_v3","eth_signTypedData_v4","hashForSignTypedData_v4","eth_signTypedData","linkAPIUrl","storage","accountsCallback","bind","chainCallback"],"sources":["../../../src/sign/walletlink/WalletLinkSigner.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}