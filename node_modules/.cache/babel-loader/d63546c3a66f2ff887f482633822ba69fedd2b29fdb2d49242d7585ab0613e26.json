{"ast":null,"code":"export class WalletLinkHTTP {\n  constructor(linkAPIUrl, sessionId, sessionKey) {\n    this.linkAPIUrl = linkAPIUrl;\n    this.sessionId = sessionId;\n    const credentials = `${sessionId}:${sessionKey}`;\n    this.auth = `Basic ${btoa(credentials)}`;\n  }\n  // mark unseen events as seen\n  async markUnseenEventsAsSeen(events) {\n    return Promise.all(events.map(e => fetch(`${this.linkAPIUrl}/events/${e.eventId}/seen`, {\n      method: 'POST',\n      headers: {\n        Authorization: this.auth\n      }\n    }))).catch(error => console.error('Unabled to mark event as failed:', error));\n  }\n  async fetchUnseenEvents() {\n    var _a;\n    const response = await fetch(`${this.linkAPIUrl}/events?unseen=true`, {\n      headers: {\n        Authorization: this.auth\n      }\n    });\n    if (response.ok) {\n      const {\n        events,\n        error\n      } = await response.json();\n      if (error) {\n        throw new Error(`Check unseen events failed: ${error}`);\n      }\n      const responseEvents = (_a = events === null || events === void 0 ? void 0 : events.filter(e => e.event === 'Web3Response').map(e => ({\n        type: 'Event',\n        sessionId: this.sessionId,\n        eventId: e.id,\n        event: e.event,\n        data: e.data\n      }))) !== null && _a !== void 0 ? _a : [];\n      this.markUnseenEventsAsSeen(responseEvents);\n      return responseEvents;\n    }\n    throw new Error(`Check unseen events failed: ${response.status}`);\n  }\n}","map":{"version":3,"names":["WalletLinkHTTP","constructor","linkAPIUrl","sessionId","sessionKey","credentials","auth","btoa","markUnseenEventsAsSeen","events","Promise","all","map","e","fetch","eventId","method","headers","Authorization","catch","error","console","fetchUnseenEvents","response","ok","json","Error","responseEvents","_a","filter","event","type","id","data","status"],"sources":["../../../../../src/sign/walletlink/relay/connection/WalletLinkHTTP.ts"],"sourcesContent":[null],"mappings":"AAEA,OAAM,MAAOA,cAAc;EAGzBC,YACmBC,UAAkB,EAClBC,SAAiB,EAClCC,UAAkB;IAFD,KAAAF,UAAU,GAAVA,UAAU;IACV,KAAAC,SAAS,GAATA,SAAS;IAG1B,MAAME,WAAW,GAAG,GAAGF,SAAS,IAAIC,UAAU,EAAE;IAChD,IAAI,CAACE,IAAI,GAAG,SAASC,IAAI,CAACF,WAAW,CAAC,EAAE;EAC1C;EAEA;EACQ,MAAMG,sBAAsBA,CAACC,MAAgC;IACnE,OAAOC,OAAO,CAACC,GAAG,CAChBF,MAAM,CAACG,GAAG,CAAEC,CAAC,IACXC,KAAK,CAAC,GAAG,IAAI,CAACZ,UAAU,WAAWW,CAAC,CAACE,OAAO,OAAO,EAAE;MACnDC,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QACPC,aAAa,EAAE,IAAI,CAACZ;;KAEvB,CAAC,CACH,CACF,CAACa,KAAK,CAAEC,KAAK,IAAKC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC,CAAC;EAC9E;EAEA,MAAME,iBAAiBA,CAAA;;IACrB,MAAMC,QAAQ,GAAG,MAAMT,KAAK,CAAC,GAAG,IAAI,CAACZ,UAAU,qBAAqB,EAAE;MACpEe,OAAO,EAAE;QACPC,aAAa,EAAE,IAAI,CAACZ;;KAEvB,CAAC;IAEF,IAAIiB,QAAQ,CAACC,EAAE,EAAE;MACf,MAAM;QAAEf,MAAM;QAAEW;MAAK,CAAE,GAAI,MAAMG,QAAQ,CAACE,IAAI,EAQ7C;MAED,IAAIL,KAAK,EAAE;QACT,MAAM,IAAIM,KAAK,CAAC,+BAA+BN,KAAK,EAAE,CAAC;MACzD;MAEA,MAAMO,cAAc,GAClB,CAAAC,EAAA,GAAAnB,MAAM,aAANA,MAAM,uBAANA,MAAM,CACFoB,MAAM,CAAEhB,CAAC,IAAKA,CAAC,CAACiB,KAAK,KAAK,cAAc,EACzClB,GAAG,CAAEC,CAAC,KAAM;QACXkB,IAAI,EAAE,OAAO;QACb5B,SAAS,EAAE,IAAI,CAACA,SAAS;QACzBY,OAAO,EAAEF,CAAC,CAACmB,EAAE;QACbF,KAAK,EAAEjB,CAAC,CAACiB,KAAK;QACdG,IAAI,EAAEpB,CAAC,CAACoB;OACT,CAAC,CAAC,cAAAL,EAAA,cAAAA,EAAA,GAAI,EAAE;MAEb,IAAI,CAACpB,sBAAsB,CAACmB,cAAc,CAAC;MAE3C,OAAOA,cAAc;IACvB;IACA,MAAM,IAAID,KAAK,CAAC,+BAA+BH,QAAQ,CAACW,MAAM,EAAE,CAAC;EACnE","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}